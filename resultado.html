<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Resultado - Simulador de Layouts</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
      html, body {
        height: 100%;
        display: flex;
        flex-direction: column;
      }
      body {
        min-height: 100vh;
      }
      main {
        flex: 1;
      }
      .hero-section {
        background: linear-gradient(135deg, #212529 0%, #495057 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
      }
      /* adaptações para a página de resultado */
      #resultado-canvas { min-height: 420px; border: 1px solid rgba(0,0,0,0.06); padding: 12px; background: #fff; }

      @media (min-width: 992px) {
        .row-eq > [class*='col-'] { display: flex; }
        .card.h-100 { display: flex; flex-direction: column; width: 100%; }
        #resultado-canvas { flex: 1 1 auto; }
      }

      #resultado-canvas .prototype-page { 
        max-width: 100%;
        margin: 0;
        padding: 0;
        box-shadow: none;
        background: transparent;
      }

      #resultado-canvas .prototype-block {
        margin: 0;
        border-radius: 0;
        padding: 0;
        box-shadow: none;
        width: 100%;
      }

      #resultado-canvas .prototype-block > * {
        width: 100%;
      }

      .feedback-list { max-height: 260px; overflow: auto; }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container">
        <a class="navbar-brand" href="index.html">Simulador de Layouts</a>
      </div>
    </nav>

    <!-- Hero Section -->
    <div class="hero-section">
      <div class="container text-center">
        <h1 class="h3 fw-bold mb-0">Resultado da Avaliação</h1>
      </div>
    </div>

    <main class="container pb-4">
      <div class="row g-4 row-eq">
        <!-- ESQUERDA: site montado (canvas) -->
        <div class="col-12 col-lg-8">
          <div class="card shadow-sm h-100">
            <div class="card-body d-flex flex-column">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                  <h5 class="mb-0">Site montado</h5>
                  <small class="text-muted">Visualização do layout final</small>
                </div>
                <div class="small text-muted">Preview</div>
              </div>

              <div id="resultado-canvas" class="mb-3"></div>

              <div class="mt-2">
                <small class="text-muted">Use "Tentar novamente" (se disponível) ou "Encerrar" para voltar ao início.</small>
              </div>
            </div>
          </div>
        </div>

        <!-- DIREITA: resumo / resultado da avaliação / feedback / persona -->
        <div class="col-12 col-lg-4">
          <div class="card shadow-sm h-100">
            <div class="card-body d-flex flex-column">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                  <h5 class="mb-0">Resultado da Avaliação</h5>
                  <small class="text-muted">Resumo e feedback</small>
                </div>
                <div class="text-end">
                  <div class="h4 mb-0" id="pontuacao">0</div>
                  <small class="text-muted">pontuação</small>
                </div>
              </div>

              <div class="mb-2">
                <div class="small text-muted">Persona</div>
                <div class="fw-semibold" id="resultado-persona">—</div>
                <div class="small text-muted">Preferência</div>
                <div id="resultado-prefer" class="small">—</div>
              </div>

              <hr>

              <h6 class="mb-2 small">Feedback</h6>
              <ul id="lista-feedback" class="mb-3 small feedback-list"></ul>

              <details id="ordem-details" class="mb-3">
                <summary class="small">Detalhes da avaliação de ordem</summary>
              </details>

              <div class="small text-muted mb-2">
                Tentativas restantes: <span id="tentativas-restantes">0</span>
              </div>

              <div class="mt-auto d-flex gap-2">
                <button id="btn-tentar" class="btn btn-warning btn-sm d-none">Tentar novamente</button>
                <button id="btn-encerrar" class="btn btn-primary btn-sm">Encerrar</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer class="bg-dark text-white text-center py-3 mt-auto">
      <div class="container">
        <p class="mb-0 small">Desenvolvido por Vinícius Alves Fantin, Bruno César Silva de Souza, Diogo Roehrs e Vitor Hugo Lopes</p>
      </div>
    </footer>

    <script src="js/componentes.js"></script>
    <script src="js/componentes-extra.js"></script>
    <script src="js/avaliacao.js"></script>
    <script>
      (function () {
        const KEY = 'simulador_retries';
        function getRetries() {
          const raw = localStorage.getItem(KEY);
          const n = raw ? parseInt(raw, 10) : 0;
          return Number.isFinite(n) ? n : 0;
        }

        function setRetries(n) {
          localStorage.setItem(KEY, String(Math.max(0, Number(n) || 0)));
        }

        function updateUI() {
          const r = getRetries();
          const tentSpan = document.getElementById('tentativas-restantes');
          if (tentSpan) tentSpan.textContent = String(r);
          const btn = document.getElementById('btn-tentar');
          if (btn) {
            if (r > 0) btn.classList.remove('d-none');
            else btn.classList.add('d-none');
          }
        }

        // Função para resetar temas ao padrão
        function resetarTodosTemasAoPadrao() {
          // Restaura HTMLs originais de todos os componentes
          (window.componentes || []).forEach(comp => {
            if (comp._originalHtml) {
              comp.html = comp._originalHtml;
              delete comp._originalHtml;
            }
          });
          
          // Remove todos os temas salvos do localStorage
          localStorage.setItem('simulador_temas_componentes', JSON.stringify({}));
          localStorage.setItem('simulador_tema_global', 'padrao');
        }

        document.getElementById('btn-tentar')?.addEventListener('click', () => {
          const r = getRetries();
          if (r <= 0) return;
          setRetries(r - 1);
          localStorage.setItem('simulador_componentes', JSON.stringify([]));
          // Reseta todos os temas ao padrão antes de tentar novamente
          resetarTodosTemasAoPadrao();
          window.location.href = 'editor.html';
        });

        document.getElementById('btn-encerrar')?.addEventListener('click', () => {
          // Reseta todos os temas ao padrão antes de encerrar
          resetarTodosTemasAoPadrao();
          window.location.href = 'index.html';
        });

        document.addEventListener('DOMContentLoaded', () => {
          updateUI();
        });
        updateUI();
      })();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
